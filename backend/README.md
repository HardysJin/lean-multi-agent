# LLMé‡åŒ–äº¤æ˜“å†³ç­–ç³»ç»Ÿ

## é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªåŸºäºLLMçš„çµæ´»é‡åŒ–äº¤æ˜“å†³ç­–ç³»ç»Ÿï¼Œé€šè¿‡åˆ†æè¿‡å»Nå¤©çš„å¸‚åœºæ•°æ®ã€æ–°é—»ã€æƒ…ç»ªç­‰å¤šç»´ä¿¡æ¯ï¼Œè¯†åˆ«å¸‚åœºçŠ¶æ€å¹¶å¯¹æœªæ¥Må¤©è¿›è¡Œé¢„æµ‹å’Œç­–ç•¥é€‰æ‹©ã€‚

**æ—¶é—´èŒƒå›´çµæ´»é…ç½®ï¼š**
- **Nå¤©å›çœ‹**ï¼šæ”¶é›†å’Œåˆ†æè¿‡å»Nå¤©çš„å†å²æ•°æ®ï¼ˆé»˜è®¤7å¤©ï¼‰
- **Må¤©é¢„æµ‹**ï¼šå¯¹æœªæ¥Må¤©çš„å¸‚åœºåšå‡ºå†³ç­–å’Œé¢„åˆ¤ï¼ˆé»˜è®¤7å¤©ï¼‰
- æ‰€æœ‰å†³ç­–éƒ½åŒ…å«æ˜ç¡®çš„åˆ†ææœŸé—´å’Œé¢„æµ‹æœŸé—´ï¼Œä¾¿äºè¿½è¸ªåŸå› 

**æ ¸å¿ƒç‰¹ç‚¹ï¼š**
- âœ… ç®€åŒ–çš„å•å±‚LLMå†³ç­–æ¶æ„ï¼ˆé¿å…è¿‡åº¦å·¥ç¨‹åŒ–ï¼‰
- âœ… æ¨¡å—åŒ–Agentè®¾è®¡ï¼ˆæŠ€æœ¯ã€æƒ…ç»ªã€æ–°é—»åˆ†æï¼‰
- âœ… ä¸¥æ ¼çš„é£æ§ç®¡ç†ï¼ˆä»“ä½é™åˆ¶ã€æ¢æ‰‹ç‡æ§åˆ¶ã€ç†”æ–­æœºåˆ¶ï¼‰
- âœ… Backtraderå›æµ‹å¼•æ“
- âœ… FastAPIåç«¯ + Reactå‰ç«¯ï¼ˆè®¡åˆ’ä¸­ï¼‰

## é¡¹ç›®ç»“æ„

```
backend/
â”œâ”€â”€ agents/              # åˆ†æAgent
â”‚   â”œâ”€â”€ base_agent.py       # AgentåŸºç±»
â”‚   â”œâ”€â”€ technical_agent.py  # æŠ€æœ¯åˆ†æ
â”‚   â”œâ”€â”€ sentiment_agent.py  # æƒ…ç»ªåˆ†æ
â”‚   â”œâ”€â”€ news_agent.py       # æ–°é—»åˆ†æ
â”‚   â””â”€â”€ coordinator.py      # ä¸»å†³ç­–Agentï¼ˆLLMï¼‰
â”‚
â”œâ”€â”€ data_collectors/     # æ•°æ®æ”¶é›†å™¨
â”‚   â”œâ”€â”€ market_data.py      # yfinanceå¸‚åœºæ•°æ®
â”‚   â”œâ”€â”€ news_collector.py   # NewsAPIæ–°é—»
â”‚   â””â”€â”€ sentiment_analyzer.py  # æƒ…ç»ªæŒ‡æ ‡
â”‚
â”œâ”€â”€ risk_control/        # é£æ§æ¨¡å—
â”‚   â”œâ”€â”€ risk_manager.py     # é£é™©ç®¡ç†å™¨
â”‚   â”œâ”€â”€ position_limiter.py # ä»“ä½é™åˆ¶
â”‚   â””â”€â”€ validator.py        # å†³ç­–éªŒè¯
â”‚
â”œâ”€â”€ strategies/          # Backtraderäº¤æ˜“ç­–ç•¥
â”‚   â”œâ”€â”€ base_strategy.py
â”‚   â”œâ”€â”€ grid_trading.py
â”‚   â”œâ”€â”€ momentum.py
â”‚   â””â”€â”€ mean_reversion.py
â”‚
â”œâ”€â”€ backtest_engine/     # å›æµ‹å¼•æ“
â”‚   â”œâ”€â”€ weekly_cerebro.py
â”‚   â””â”€â”€ performance_analyzer.py
â”‚
â”œâ”€â”€ database/            # æ•°æ®æŒä¹…åŒ–
â”‚   â”œâ”€â”€ models.py
â”‚   â”œâ”€â”€ decision_store.py
â”‚   â””â”€â”€ portfolio_store.py
â”‚
â”œâ”€â”€ api/                 # FastAPIæ¥å£
â”‚   â””â”€â”€ main.py
â”‚
â”œâ”€â”€ config/              # é…ç½®
â”‚   â”œâ”€â”€ config.yaml         # ç³»ç»Ÿé…ç½®
â”‚   â”œâ”€â”€ config_loader.py    # é…ç½®åŠ è½½å™¨
â”‚   â””â”€â”€ prompts.py          # LLM prompts
â”‚
â””â”€â”€ utils/               # å·¥å…·æ¨¡å—
    â”œâ”€â”€ llm_client.py       # LLMå®¢æˆ·ç«¯
    â””â”€â”€ logger.py           # æ—¥å¿—
```

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

å¤åˆ¶`.env.example`ä¸º`.env`å¹¶å¡«å…¥ä½ çš„APIå¯†é’¥ï¼š

```bash
cp .env.example .env
```

ç¼–è¾‘`.env`æ–‡ä»¶ï¼š
```
OPENAI_API_KEY=your_key_here
NEWS_API_KEY=your_key_here  # å¯é€‰
```

### 3. é…ç½®æ—¶é—´èŒƒå›´ï¼ˆå¯é€‰ï¼‰

ç¼–è¾‘`backend/config/config.yaml`ï¼š

```yaml
system:
  lookback_days: 7    # åˆ†æè¿‡å»7å¤©
  forecast_days: 7    # é¢„æµ‹æœªæ¥7å¤©
```

ä½ å¯ä»¥çµæ´»è°ƒæ•´ï¼Œæ¯”å¦‚ï¼š
- `lookback_days: 30, forecast_days: 7` - åŸºäºè¿‡å»ä¸€ä¸ªæœˆæ•°æ®ï¼Œé¢„æµ‹ä¸‹å‘¨
- `lookback_days: 3, forecast_days: 1` - åŸºäºè¿‡å»3å¤©ï¼Œé¢„æµ‹æ˜å¤©
- `lookback_days: 14, forecast_days: 14` - åŸºäºè¿‡å»ä¸¤å‘¨ï¼Œé¢„æµ‹æœªæ¥ä¸¤å‘¨

### 4. è¿è¡ŒMVPæµ‹è¯•

æµ‹è¯•å®Œæ•´çš„å†³ç­–æµç¨‹ï¼š

```bash
python tmp/test_mvp_weekly_decision.py
```

è¿™ä¼šæ‰§è¡Œï¼š
1. æ”¶é›†è¿‡å»Nå¤©å¸‚åœºæ•°æ®ï¼ˆSPY, QQQ, VIXï¼‰
2. æŠ€æœ¯åˆ†æã€æƒ…ç»ªåˆ†æã€æ–°é—»åˆ†æ
3. LLMåŸºäºå†å²æ•°æ®ç”Ÿæˆæœªæ¥Må¤©çš„äº¤æ˜“å†³ç­–
4. é£æ§éªŒè¯å’Œè°ƒæ•´
5. ä¿å­˜å†³ç­–ç»“æœåˆ°`./tmp/mvp_test_decision.json`

å†³ç­–ç»“æœåŒ…å«ï¼š
```json
{
  "analysis_period": {"start": "2025-11-04", "end": "2025-11-11", "days": 7},
  "forecast_period": {"start": "2025-11-11", "end": "2025-11-18", "days": 7},
  "market_state": "ranging",
  "recommended_strategy": "grid_trading",
  "reasoning": "åŸºäºè¿‡å»7å¤©çš„åˆ†æ...",
  ...
}
```

### 5. æŸ¥çœ‹æ—¥å¿—

```bash
tail -f Logs/mvp_test.log
```

## å†³ç­–æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ•°æ®æ”¶é›†é˜¶æ®µ     â”‚
â”‚ - å¸‚åœºæ•°æ®       â”‚
â”‚ - æ–°é—»äº‹ä»¶       â”‚
â”‚ - æƒ…ç»ªæŒ‡æ ‡       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Agentåˆ†æé˜¶æ®µ    â”‚
â”‚ - TechnicalAgent â”‚
â”‚ - SentimentAgent â”‚
â”‚ - NewsAgent      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Coordinatorå†³ç­–  â”‚
â”‚ - LLMç»¼åˆåˆ†æ    â”‚
â”‚ - ç»“æ„åŒ–è¾“å‡º     â”‚
â”‚ - ç­–ç•¥é€‰æ‹©       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é£æ§éªŒè¯        â”‚
â”‚ - ä»“ä½é™åˆ¶       â”‚
â”‚ - æ¢æ‰‹ç‡æ£€æŸ¥     â”‚
â”‚ - é£é™©è°ƒæ•´       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç­–ç•¥æ‰§è¡Œ        â”‚
â”‚ - Backtrader    â”‚
â”‚ - è®°å½•ç»“æœ       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## é…ç½®è¯´æ˜

### LLMé…ç½® (`backend/config/config.yaml`)

```yaml
llm:
  provider: openai  # openai, anthropic, deepseek
  model: gpt-4o
  temperature: 0.3
  can_suggest_positions: true   # æ˜¯å¦å…è®¸LLMå»ºè®®ä»“ä½
  auto_execute: false            # æ˜¯å¦è‡ªåŠ¨æ‰§è¡Œï¼ˆå»ºè®®falseï¼‰
  require_approval: true         # æ˜¯å¦éœ€è¦äººå·¥å®¡æ‰¹
```

### é£æ§é…ç½®

```yaml
risk:
  max_single_position: 0.3      # å•åªè‚¡ç¥¨æœ€å¤š30%
  min_cash_reserve: 0.2         # è‡³å°‘20%ç°é‡‘
  max_weekly_turnover: 0.5      # å•å‘¨æ¢æ‰‹ç‡â‰¤50%
  max_drawdown: 0.15            # æœ€å¤§å›æ’¤15%è§¦å‘ç†”æ–­
  stop_loss_pct: 0.05           # å•åªè‚¡ç¥¨æ­¢æŸ5%
```

## å¼€å‘è¿›åº¦

### âœ… å·²å®Œæˆï¼ˆMVPé˜¶æ®µï¼‰

- [x] é¡¹ç›®ç»“æ„å’Œé…ç½®ç³»ç»Ÿ
- [x] æ•°æ®æ”¶é›†å™¨ï¼ˆå¸‚åœºã€æ–°é—»ã€æƒ…ç»ªï¼‰
- [x] åˆ†æAgentï¼ˆæŠ€æœ¯ã€æƒ…ç»ªã€æ–°é—»ï¼‰
- [x] Coordinatorä¸»å†³ç­–Agentï¼ˆLLMï¼‰
- [x] é£æ§æ¨¡å—ï¼ˆéªŒè¯ã€é™åˆ¶ã€è°ƒæ•´ï¼‰
- [x] MVPæµ‹è¯•è„šæœ¬

### ğŸš§ è¿›è¡Œä¸­

- [ ] Backtraderç­–ç•¥å®ç°
- [ ] å‘¨åº¦å›æµ‹å¼•æ“
- [ ] æ•°æ®åº“æ¨¡å‹å’Œå­˜å‚¨
- [ ] FastAPIåç«¯æ¥å£

### ğŸ“‹ è®¡åˆ’ä¸­

- [ ] Reactå‰ç«¯UI
- [ ] å®Œæ•´å›æµ‹åŠŸèƒ½
- [ ] æ€§èƒ½åˆ†æå’Œå¯è§†åŒ–
- [ ] éƒ¨ç½²æ–¹æ¡ˆ

## æ ¸å¿ƒè®¾è®¡åŸåˆ™

1. **ç®€åŒ–æ¶æ„**ï¼šé¿å…å¤šå±‚LLMåµŒå¥—ï¼Œä½¿ç”¨å•å±‚å†³ç­–
2. **ä¸¥æ ¼é£æ§**ï¼šæ‰€æœ‰å†³ç­–å¿…é¡»é€šè¿‡é£æ§éªŒè¯
3. **å¯æ‰©å±•æ€§**ï¼šAgentæ¨¡å—åŒ–ï¼Œæ˜“äºæ·»åŠ æ–°çš„åˆ†æç»´åº¦
4. **å¯è§‚æµ‹æ€§**ï¼šè¯¦ç»†æ—¥å¿—ï¼Œæ‰€æœ‰å†³ç­–å¯è¿½æº¯
5. **ä¿å®ˆé»˜è®¤**ï¼šå½“ä¸ç¡®å®šæ—¶ï¼Œé€‰æ‹©ä¿å®ˆç­–ç•¥ï¼ˆhold + é«˜ç°é‡‘ï¼‰

## ä½¿ç”¨å»ºè®®

### Phase 1: çº¯ç­–ç•¥é€‰æ‹©ï¼ˆæ¨èæ–°æ‰‹ï¼‰
```yaml
llm:
  can_suggest_positions: false  # LLMåªé€‰ç­–ç•¥ï¼Œä¸è°ƒä»“
  auto_execute: false
  require_approval: true
```

### Phase 2: å»ºè®®ä»“ä½ + äººå·¥å®¡æ‰¹
```yaml
llm:
  can_suggest_positions: true   # LLMå»ºè®®ä»“ä½
  auto_execute: false
  require_approval: true        # éœ€è¦äººå·¥ç¡®è®¤
```

### Phase 3: è‡ªåŠ¨æ‰§è¡Œï¼ˆè°¨æ…ï¼ï¼‰
```yaml
llm:
  can_suggest_positions: true
  auto_execute: true
  require_approval: false       # ä»…é£æ§éªŒè¯ï¼Œè‡ªåŠ¨æ‰§è¡Œ
```

## æ³¨æ„äº‹é¡¹

âš ï¸ **é£é™©æç¤º**ï¼š
- è¿™æ˜¯ä¸€ä¸ªå®éªŒæ€§é¡¹ç›®ï¼Œä»…ä¾›å­¦ä¹ å’Œç ”ç©¶
- çœŸå®äº¤æ˜“å‰è¯·å……åˆ†å›æµ‹å’Œå°ä»“ä½æµ‹è¯•
- LLMå¯èƒ½äº§ç”Ÿä¸åˆç†çš„å†³ç­–ï¼Œé£æ§æ¨¡å—ä¼šæ‹¦æˆªä½†ä¸ä¿è¯100%
- å¸‚åœºæœ‰é£é™©ï¼ŒæŠ•èµ„éœ€è°¨æ…

## ä¸‹ä¸€æ­¥

è¿è¡ŒMVPæµ‹è¯•åï¼Œä½ å¯ä»¥ï¼š

1. **æŸ¥çœ‹å†³ç­–ç»“æœ**ï¼š`cat tmp/mvp_test_decision.json`
2. **è°ƒæ•´é…ç½®**ï¼šä¿®æ”¹`backend/config/config.yaml`
3. **å®ç°å›æµ‹**ï¼šç»§ç»­å¼€å‘Backtraderç­–ç•¥æ¨¡å—
4. **éƒ¨ç½²API**ï¼šå¯åŠ¨FastAPIåç«¯æœåŠ¡

## License

MIT

## è”ç³»æ–¹å¼

Issues: https://github.com/HardysJin/lean-multi-agent/issues
