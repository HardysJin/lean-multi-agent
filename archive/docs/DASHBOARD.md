# 📈 Multi-Agent 回测系统 Dashboard 使用指南

## 快速开始

### 1. 启动 Dashboard

```bash
cd /home/hardys/git/lean-multi-agent
streamlit run dashboard.py
```

Dashboard 将在浏览器中自动打开：`http://localhost:8501`

### 2. 配置回测参数

#### 📊 股票选择
- 输入一个或多个股票代码（用逗号分隔）
- 例如: `AAPL` 或 `AAPL, MSFT, GOOGL`

#### 📅 回测周期
- **开始日期**: 回测起始日期
- **结束日期**: 回测结束日期
- 建议：至少选择 3 个月以上的数据

#### 💰 资金配置
- **初始资金**: 回测初始投资金额（默认 $100,000）
- **手续费率**: 每笔交易的手续费比例（默认 0.1%）

#### 🤖 策略选择

**选项 1: 简单移动平均 (SMA)**
- ⚡ 速度快，无需 API
- 📊 基于技术指标的经典策略
- ⚙️ 可调参数：
  - 短期均线周期（默认 20 天）
  - 长期均线周期（默认 50 天）

**选项 2: Multi-Agent 策略**
- 🧠 AI 驱动，更智能
- 📰 结合新闻情绪分析
- ⚠️ 需要配置 LLM API（OpenAI/Anthropic/DeepSeek）
- ⏱️ 运行时间较长

### 3. 运行回测

点击侧边栏底部的 **"🚀 运行回测"** 按钮。

系统会：
1. 加载股票数据
2. 生成交易信号
3. 执行回测
4. 计算性能指标

### 4. 查看结果

回测完成后，Dashboard 会显示：

#### 📊 关键指标卡片

| 指标 | 说明 |
|------|------|
| **总收益率** | 整个回测期间的总收益率（%）|
| **最终价值** | 回测结束时的投资组合总价值 |
| **夏普比率** | 风险调整后的收益率（>1 为良好）|
| **交易次数** | 回测期间的总交易次数 |
| **胜率** | 盈利交易占总交易的比例 |
| **最大回撤** | 投资组合从峰值下跌的最大幅度 |
| **年化收益率** | 按年化计算的收益率 |
| **回测天数** | 回测时间跨度 |

#### 📈 性能图表

**图表 1: 价格与交易信号**
- 📉 股票价格走势
- 🟢 买入信号点（绿色三角形）
- 🔴 卖出信号点（红色三角形）

**图表 2: 投资组合价值**
- 💰 投资组合价值变化曲线
- ➖ 初始资金基准线（虚线）
- 📊 填充区域显示增长情况

**图表 3: 每日收益率**
- 📊 每日收益率柱状图
- 🟢 正收益（绿色）
- 🔴 负收益（红色）

#### 💾 导出功能

1. **生成完整报告**
   - 📄 HTML 交互式报告
   - 📊 JSON 数据文件
   - 保存在 `Results/` 目录

2. **下载 CSV**
   - 📥 下载回测结果表格
   - 包含所有性能指标
   - 方便进一步分析

---

## 高级功能

### 多股票回测

输入多个股票代码（用逗号分隔）：
```
AAPL, MSFT, GOOGL, TSLA
```

系统会为每个股票独立运行回测，然后可以在下拉菜单中切换查看。

### 策略对比（开发中）

未来版本将支持：
- 同时运行多个策略
- 并排对比结果
- 策略性能排名

---

## 性能优化建议

### ⚡ 快速回测
- 使用 **简单移动平均策略**
- 选择较短的回测周期（1-3 个月）
- 测试单个股票

### 🎯 准确回测
- 使用 **Multi-Agent 策略**
- 选择较长的回测周期（6-12 个月）
- 确保有足够的历史数据

### 📊 大规模回测
- 分批次运行多个股票
- 使用 CLI 工具（`python test_backtest.py`）
- 考虑使用缓存机制

---

## 常见问题

### Q1: Dashboard 无法启动？

**解决方案**:
```bash
# 安装依赖
pip install streamlit plotly

# 检查端口是否被占用
lsof -i :8501

# 使用不同端口启动
streamlit run dashboard.py --server.port 8502
```

### Q2: 回测速度太慢？

**原因**:
- Multi-Agent 策略需要调用 LLM API
- 回测周期太长
- 股票数量太多

**解决方案**:
- 先使用简单移动平均策略测试
- 缩短回测周期
- 减少股票数量
- 检查网络连接

### Q3: 数据加载失败？

**可能原因**:
- 股票代码错误
- 日期范围无效（未来日期）
- 网络问题

**解决方案**:
- 检查股票代码拼写
- 确保日期在有效范围内
- 检查网络连接

### Q4: Multi-Agent 策略报错？

**检查清单**:
```bash
# 1. 检查环境变量
cat .env | grep API

# 2. 测试 API 连接
python -c "from openai import OpenAI; print(OpenAI().models.list())"

# 3. 查看详细日志
streamlit run dashboard.py --logger.level=debug
```

### Q5: 图表显示不正常？

**解决方案**:
```bash
# 清除缓存
rm -rf .streamlit/cache

# 重启 Dashboard
streamlit run dashboard.py --server.runOnSave true
```

---

## 技术架构

```
dashboard.py
    ├── Streamlit UI 框架
    │   ├── 侧边栏配置
    │   ├── 主界面展示
    │   └── 交互式组件
    │
    ├── VectorBT 回测引擎
    │   ├── 数据加载 (yfinance)
    │   ├── 信号生成
    │   └── 性能计算
    │
    ├── 策略模块
    │   ├── SimpleTechnicalStrategy
    │   └── MultiAgentStrategy
    │
    └── 可视化
        ├── Plotly 图表
        ├── 性能指标卡片
        └── 数据导出
```

---

## 下一步计划

### 🚀 即将推出

- [ ] **策略对比功能**: 同时运行多个策略并对比
- [ ] **参数优化**: 自动寻找最佳策略参数
- [ ] **实时监控**: 连接实时行情数据
- [ ] **风险分析**: VaR、CVaR 等风险指标
- [ ] **多周期分析**: 支持分钟/小时/日/周/月级别

### 💡 功能建议

如果你有功能建议，请：
1. 在 GitHub 提 Issue
2. 或者直接 PR 贡献代码

---

## 免责声明

⚠️ **重要提示**:

- 本系统仅供学习研究使用
- 不构成任何投资建议
- 历史表现不代表未来收益
- 投资有风险，入市需谨慎

---

## 相关链接

- 📖 [项目文档](../README.md)
- 🧪 [测试指南](../Tests/README.md)
- 🔧 [回测模式说明](./BACKTEST_MODE.md)
- 📊 [VectorBT 文档](https://vectorbt.dev/)
- 🎨 [Streamlit 文档](https://docs.streamlit.io/)

---

**Happy Trading! 📈**
