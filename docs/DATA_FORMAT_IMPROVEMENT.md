# LEAN æ•°æ®æ ¼å¼æ”¹è¿›æ€»ç»“

## ğŸ¯ æ”¹è¿›ç›®æ ‡
å°†åˆ†é’Ÿæ•°æ®ä¸‹è½½æ ¼å¼æ”¹ä¸ºå®Œå…¨åŒ¹é… LEAN å®˜æ–¹æ ¼å¼

## âœ… å®Œæˆçš„æ”¹è¿›

### 1. åˆ†é’Ÿæ•°æ®æ ¼å¼ï¼ˆå®Œå…¨åŒ¹é… LEAN å®˜æ–¹ï¼‰

**ä¹‹å‰çš„æ ¼å¼ï¼š**
```
Lean/Data/equity/usa/minute/
  â””â”€â”€ soxl.zip
      â””â”€â”€ soxl.csv  (æ‰€æœ‰åˆ†é’Ÿæ•°æ®åœ¨ä¸€ä¸ªæ–‡ä»¶)
```

**ç°åœ¨çš„æ ¼å¼ï¼ˆLEAN å®˜æ–¹ï¼‰ï¼š**
```
Lean/Data/equity/usa/minute/
  â””â”€â”€ soxl/
      â”œâ”€â”€ 20251031_trade.zip
      â”‚   â””â”€â”€ 20251031_soxl_minute_trade.csv
      â”œâ”€â”€ 20251101_trade.zip
      â””â”€â”€ ...
```

**æ ¼å¼ç‰¹ç‚¹ï¼š**
- âœ… æ¯ä¸ªè‚¡ç¥¨ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼ˆ`{symbol}/`ï¼‰
- âœ… æ¯å¤©ä¸€ä¸ªç‹¬ç«‹çš„ ZIP æ–‡ä»¶ï¼ˆ`YYYYMMDD_trade.zip`ï¼‰
- âœ… CSV æ–‡ä»¶åï¼š`YYYYMMDD_{symbol}_minute_trade.csv`
- âœ… ä»·æ ¼ä½¿ç”¨æµ®ç‚¹æ•°æ ¼å¼ï¼ˆå¦‚ `48.77`ï¼‰ï¼Œä¿ç•™2ä½å°æ•°
- âœ… æ—¶é—´æ ¼å¼ï¼š`YYYYMMDD HH:MM`

### 2. æ•°æ®æ ¼å¼ç¤ºä¾‹å¯¹æ¯”

#### åˆ†é’Ÿæ•°æ®
```csv
# æˆ‘ä»¬çš„æ ¼å¼ï¼ˆç°åœ¨ï¼‰
20251031 09:30,48.77,48.80,48.31,48.38,4876707
20251031 09:31,48.39,48.68,48.35,48.68,587913

# LEAN å®˜æ–¹æ ¼å¼
20240102 09:30,472.54,472.80,471.36,471.76,19608168
20240102 10:30,471.77,472.45,471.30,472.33,9085308

âœ… æ ¼å¼å®Œå…¨ä¸€è‡´ï¼
```

#### æ—¥çº¿æ•°æ®ï¼ˆä¿æŒä¸å˜ï¼‰
```csv
# æ•´æ•°æ ¼å¼ï¼ˆä»·æ ¼ Ã— 10000ï¼‰
20240102 00:00,487700,487999,483100,483800,4876707
20240103 00:00,483899,486800,483499,486800,5879130
```

### 3. ä»£ç æ”¹è¿›

#### `Utils/download_data.py`

**æ–°å¢é…ç½®ï¼š**
```python
RESOLUTION_MAP = {
    'minute': {
        'split_by_day': True,      # æŒ‰å¤©åˆ†æ–‡ä»¶
        'price_multiplier': 1,     # æµ®ç‚¹ä»·æ ¼
    },
    'daily': {
        'split_by_day': False,     # å•ä¸ªæ–‡ä»¶
        'price_multiplier': 10000, # æ•´æ•°ä»·æ ¼
    }
}
```

**æ–°å¢å‡½æ•°ï¼š**
- `_save_minute_data_by_day()` - æŒ‰å¤©ä¿å­˜åˆ†é’Ÿæ•°æ®
- `_save_consolidated_data()` - ä¿å­˜æ—¥çº¿/å°æ—¶æ•°æ®
- `get_data_dir_for_resolution()` - æ”¯æŒåˆ†é’Ÿæ•°æ®çš„å­ç›®å½•

**æ”¹è¿›çš„åŠŸèƒ½ï¼š**
- âœ… è‡ªåŠ¨è¯†åˆ«åˆ†è¾¨ç‡ç±»å‹
- âœ… æ ¹æ®åˆ†è¾¨ç‡ä½¿ç”¨ä¸åŒçš„ä¿å­˜æ ¼å¼
- âœ… åˆ†é’Ÿæ•°æ®è‡ªåŠ¨åˆ›å»ºè‚¡ç¥¨å­ç›®å½•
- âœ… è¯¦ç»†çš„ä¸‹è½½æ—¥å¿—å’Œé”™è¯¯æç¤º

### 4. ç›®å½•ç»“æ„å¯¹æ¯”

```
ä¹‹å‰ï¼š
Lean/Data/equity/usa/
  â”œâ”€â”€ daily/
  â”‚   â”œâ”€â”€ spy.zip
  â”‚   â””â”€â”€ soxl.zip
  â””â”€â”€ minute/
      â”œâ”€â”€ spy.zip      âŒ é”™è¯¯æ ¼å¼
      â””â”€â”€ soxl.zip     âŒ é”™è¯¯æ ¼å¼

ç°åœ¨ï¼š
Lean/Data/equity/usa/
  â”œâ”€â”€ daily/
  â”‚   â”œâ”€â”€ spy.zip
  â”‚   â””â”€â”€ soxl.zip
  â””â”€â”€ minute/
      â”œâ”€â”€ spy/         âœ… æ­£ç¡®æ ¼å¼
      â”‚   â”œâ”€â”€ 20240102_trade.zip
      â”‚   â””â”€â”€ ...
      â””â”€â”€ soxl/        âœ… æ­£ç¡®æ ¼å¼
          â”œâ”€â”€ 20251031_trade.zip
          â”œâ”€â”€ 20251101_trade.zip
          â””â”€â”€ ...
```

## ğŸ“Š éªŒè¯ç»“æœ

### æµ‹è¯•ä¸‹è½½
```bash
$ python3 -c "from Utils.download_data import download_and_convert; ..."

è¾“å‡ºï¼š
============================================================
ä¸‹è½½ SOXL æ•°æ® (minute)...
============================================================
âœ… è·å–åˆ° 1950 æ¡çš„æ•°æ®
ğŸ“ æŒ‰å¤©åˆ†æ–‡ä»¶ä¿å­˜åˆ°: ./Lean/Data/equity/usa/minute/soxl/
ğŸ’¾ ä¿å­˜å®Œæˆ: 5 ä¸ªäº¤æ˜“æ—¥
```

### æ ¼å¼å¯¹æ¯”
```python
# æˆ‘ä»¬ç”Ÿæˆçš„æ ¼å¼
æ–‡ä»¶: 20251031_trade.zip
CSV: 20251031_soxl_minute_trade.csv
æ•°æ®: 20251031 09:30,48.77,48.80,48.31,48.38,4876707

# LEAN å®˜æ–¹æ ¼å¼
æ–‡ä»¶: 20240102_trade.zip
CSV: 20240102_spy_minute_trade.csv
æ•°æ®: 20240102 09:30,472.54,472.80,471.36,471.76,19608168

âœ… æ ¼å¼åŒ¹é…ï¼
```

## ğŸ“ ä½¿ç”¨æ–¹æ³•

### è‡ªåŠ¨ä¸‹è½½ï¼ˆæ¨èï¼‰
ç­–ç•¥ä¸­ä½¿ç”¨ `SmartAlgorithm` ä¼šè‡ªåŠ¨ä¸‹è½½æ­£ç¡®æ ¼å¼çš„æ•°æ®ï¼š

```python
class MyStrategy(SmartAlgorithm):
    def initialize(self):
        self.set_start_date(2025, 10, 15)
        self.set_end_date(2025, 11, 7)
        
        # è‡ªåŠ¨ä¸‹è½½åˆ†é’Ÿæ•°æ®ï¼ˆLEAN æ ¼å¼ï¼‰
        self.spy = self.add_equity_smart("SPY", Resolution.MINUTE)
```

### æ‰‹åŠ¨ä¸‹è½½
```python
from Utils.download_data import download_and_convert
from datetime import datetime, timedelta

end = datetime.now()
start = end - timedelta(days=7)

# ä¸‹è½½åˆ†é’Ÿæ•°æ®ï¼ˆè‡ªåŠ¨ä½¿ç”¨ LEAN æ ¼å¼ï¼‰
download_and_convert(
    'SOXL',
    start.strftime('%Y-%m-%d'),
    end.strftime('%Y-%m-%d'),
    resolution='minute'
)
```

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### ä»·æ ¼æ ¼å¼
- **åˆ†é’Ÿæ•°æ®**: æµ®ç‚¹æ•°ï¼Œä¿ç•™2ä½å°æ•°ï¼ˆ`round(price, 2)`ï¼‰
- **æ—¥çº¿æ•°æ®**: æ•´æ•°ï¼Œä»·æ ¼ Ã— 10000ï¼ˆ`int(price * 10000)`ï¼‰

### æ–‡ä»¶å‘½å
- **åˆ†é’Ÿæ•°æ®**: `YYYYMMDD_trade.zip` â†’ `YYYYMMDD_{symbol}_minute_trade.csv`
- **æ—¥çº¿æ•°æ®**: `{symbol}.zip` â†’ `{symbol}.csv`

### æ•°æ®åˆ†ç»„
```python
# åˆ†é’Ÿæ•°æ®æŒ‰å¤©åˆ†ç»„
df_grouped = df.groupby(df.index.date)
for date, day_data in df_grouped:
    # ä¸ºæ¯ä¸€å¤©åˆ›å»ºä¸€ä¸ª zip æ–‡ä»¶
    ...
```

## ğŸ“ ç›¸å…³æ–‡ä»¶

- âœ… `Utils/download_data.py` - æ ¸å¿ƒä¸‹è½½é€»è¾‘ï¼ˆå·²æ›´æ–°ï¼‰
- âœ… `Algorithm/SmartAlgorithm.py` - æ™ºèƒ½ä¸‹è½½åŸºç±»ï¼ˆå·²æ›´æ–°ï¼‰
- âœ… `Algorithm/EMAChannelStrategy.py` - ç¤ºä¾‹ç­–ç•¥
- âœ… `docs/MINUTE_DATA_GUIDE.md` - ä½¿ç”¨æ–‡æ¡£ï¼ˆå·²æ›´æ–°ï¼‰
- âœ… `Tests/test_ema_channel.sh` - æµ‹è¯•è„šæœ¬

## ğŸ‰ ä¼˜åŠ¿

1. **å®Œå…¨å…¼å®¹**: ä¸ LEAN å®˜æ–¹æ•°æ®æ ¼å¼100%å…¼å®¹
2. **é«˜æ•ˆå­˜å‚¨**: åˆ†é’Ÿæ•°æ®æŒ‰å¤©åˆ†æ–‡ä»¶ï¼Œä¾¿äºç®¡ç†
3. **æ˜“äºæ‰©å±•**: åªéœ€ä¸‹è½½ç¼ºå¤±çš„äº¤æ˜“æ—¥æ•°æ®
4. **è‡ªåŠ¨åŒ–**: SmartAlgorithm è‡ªåŠ¨å¤„ç†ä¸€åˆ‡
5. **çµæ´»æ€§**: æ”¯æŒ daily/hour/minute å¤šç§åˆ†è¾¨ç‡

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **Yahoo Finance é™åˆ¶**: åˆ†é’Ÿæ•°æ®é€šå¸¸åªæä¾›æœ€è¿‘7-60å¤©
2. **å­˜å‚¨ç©ºé—´**: åˆ†é’Ÿæ•°æ®ä¼šç”Ÿæˆå¤§é‡å°æ–‡ä»¶
3. **æ—¶é—´èŒƒå›´**: å›æµ‹æ—¶é—´èŒƒå›´è¦åœ¨æ•°æ®å¯ç”¨èŒƒå›´å†…

## ğŸš€ ä¸‹ä¸€æ­¥

- âœ… åˆ†é’Ÿæ•°æ®æ ¼å¼å·²å®Œæˆ
- â³ å¯è€ƒè™‘æ·»åŠ  quoteï¼ˆæŠ¥ä»·ï¼‰æ•°æ®æ”¯æŒ
- â³ å¯è€ƒè™‘æ”¯æŒå…¶ä»–æ•°æ®æºï¼ˆAlpha Vantage, IEX ç­‰ï¼‰
